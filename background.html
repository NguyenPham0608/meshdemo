<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Glass Orbit Playground with Multi-Color Torus Knot</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: black;
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>
    <script type="module">
        import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js";

        // Scene, camera, renderer
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        // Lights
        const light = new THREE.DirectionalLight(0xffffff, 3);
        const ambientLight = new THREE.AmbientLight(0xffffff, 3);
        scene.add(ambientLight);
        light.position.set(1, 1, 1);
        scene.add(light);

        // Environment map (optional background toggle)
        const cubeTextureSets = ["Bridge2", "Park2"];
        const selectedSet = cubeTextureSets[Math.floor(Math.random() * cubeTextureSets.length)];
        const loader = new THREE.CubeTextureLoader();
        const envMap = loader.load([
            `https://threejs.org/examples/textures/cube/${selectedSet}/posx.jpg`,
            `https://threejs.org/examples/textures/cube/${selectedSet}/negx.jpg`,
            `https://threejs.org/examples/textures/cube/${selectedSet}/posy.jpg`,
            `https://threejs.org/examples/textures/cube/${selectedSet}/negy.jpg`,
            `https://threejs.org/examples/textures/cube/${selectedSet}/posz.jpg`,
            `https://threejs.org/examples/textures/cube/${selectedSet}/negz.jpg`
        ]);
        scene.background = null;
        let bgOn = false;
        let savedBackground = envMap;

        // Torus knot geometry with vertex colors
        const geometry = new THREE.TorusKnotGeometry(2, 0.8, 400, 64);
        const colors = new Float32Array(geometry.attributes.position.count * 3);

        // Initial color assignment (4-color cycle)
        const baseColors = [
            new THREE.Color("red"),
            new THREE.Color("yellow"),
            new THREE.Color("blue"),
            new THREE.Color("green")
        ];
        for (let i = 0; i < geometry.attributes.position.count; i++) {
            const c = baseColors[i % baseColors.length];
            colors[i * 3 + 0] = c.r;
            colors[i * 3 + 1] = c.g;
            colors[i * 3 + 2] = c.b;
        }
        geometry.setAttribute("color", new THREE.BufferAttribute(colors, 3));

        // Glass-like material with vertex colors
        const material = new THREE.MeshPhysicalMaterial({
            vertexColors: true,
            metalness: 0,
            roughness: 0,
            transmission: 0.9,
            thickness: 0.9,
            ior: 1.75,
            envMapIntensity: 1,
            clearcoat: 1,
            clearcoatRoughness: 1,
            side: THREE.DoubleSide
        });

        // Torus knot mesh
        const torusKnot = new THREE.Mesh(geometry, material);
        scene.add(torusKnot);

        // Camera orbit logic
        let angle = 0;
        let radius = 12;
        let tilt = 0.3;
        camera.lookAt(0, 0, 0);

        // Wheel scroll for orbit
        window.addEventListener("wheel", e => {
            angle += e.deltaY * 0.002;
        });

        // Resize
        window.addEventListener("resize", () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Background toggle with "B"
        window.addEventListener("keydown", (e) => {
            if (e.key.toLowerCase() === "b") {
                bgOn = !bgOn;
                scene.background = bgOn ? savedBackground : null;
            }
        });

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);

            // Orbit camera
            const x = Math.cos(angle) * radius;
            const z = Math.sin(angle) * radius;
            const y = Math.sin(tilt) * radius * 0.3;
            camera.position.set(x, y, z);
            camera.lookAt(0, 0, 0);

            // Animate colors flowing around the knot
            const time = Date.now() * 0.0001;
            const colorAttr = geometry.attributes.color;
            for (let i = 0; i < colorAttr.count; i++) {
                const hue = ((i / colorAttr.count) + time) % 1.0;
                const color = new THREE.Color().setHSL(hue, 1.0, 0.5);
                colorAttr.setXYZ(i, color.r, color.g, color.b);
            }
            colorAttr.needsUpdate = true;

            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>

</html>