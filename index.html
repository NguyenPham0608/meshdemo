<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Glass Orbit Playground with Bunny</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: black;
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@v0.179.1/build/three.module.js",
                "jsm/": "https://cdn.jsdelivr.net/npm/three@0.171.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from "jsm/loaders/GLTFLoader.js";
        import { OrbitControls } from "jsm/controls/OrbitControls.js";

        // Scene, camera, renderer
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 30, 100);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        // OrbitControls
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 2;

        // Lights
        const light = new THREE.DirectionalLight(0xffffff, 3);
        const ambientLight = new THREE.AmbientLight(0xffffff, 3);
        light.position.set(1, 1, 1);
        scene.add(light, ambientLight);

        // Environment map
        const cubeTextureSets = ["Bridge2", "Park2"];
        const selectedSet = cubeTextureSets[Math.floor(Math.random() * cubeTextureSets.length)];
        const loaderEnv = new THREE.CubeTextureLoader();
        let envMap = loaderEnv.load([
            `https://threejs.org/examples/textures/cube/${selectedSet}/posx.jpg`,
            `https://threejs.org/examples/textures/cube/${selectedSet}/negx.jpg`,
            `https://threejs.org/examples/textures/cube/${selectedSet}/posy.jpg`,
            `https://threejs.org/examples/textures/cube/${selectedSet}/negy.jpg`,
            `https://threejs.org/examples/textures/cube/${selectedSet}/posz.jpg`,
            `https://threejs.org/examples/textures/cube/${selectedSet}/negz.jpg`
        ]);
        let bgOn = false;

        let savedBackground = envMap;
        scene.background = bgOn ? envMap : null;

        // Glass material
        const glassMaterial = new THREE.MeshPhysicalMaterial({
            color: 0xf0f8ff,      // slight blue tint for realism
            metalness: 0,
            roughness: 0.05,      // very smooth
            transmission: 1,      // fully transparent
            thickness: 5,         // makes light bend inside the mesh
            ior: 1.9,             // index of refraction
            envMap: envMap,
            envMapIntensity: 1.5, // make reflections pop
            clearcoat: 1,
            clearcoatRoughness: 0.05,
            reflectivity: 0.9,
            side: THREE.DoubleSide,
            transparent: true,
            opacity: 0.95
        });

        const gltfLoader = new GLTFLoader();
        let bunnyMesh;

        gltfLoader.load(
            'bunny.glb', // replace with your bunny.glb link
            (gltf) => {
                gltf.scene.traverse((child) => {
                    if (child.isMesh) {
                        bunnyMesh = child;

                        // Center geometry
                        child.geometry.computeBoundingBox();
                        const box = child.geometry.boundingBox;
                        const center = new THREE.Vector3();
                        box.getCenter(center);
                        child.geometry.translate(-center.x, -center.y, -center.z);

                        // Apply glass material
                        child.material = glassMaterial;
                    }
                });

                scene.add(gltf.scene);
            },
            undefined,
            (error) => console.error("Error loading bunny:", error)
        );

        // Toggle environment background
        window.addEventListener("keydown", (e) => {
            if (e.key.toLowerCase() === "b") {
                bgOn = !bgOn;
                scene.background = bgOn ? savedBackground : null;
            }
        });

        // Resize handler
        window.addEventListener("resize", () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);

            // Auto-rotate handled by OrbitControls
            controls.update();

            renderer.render(scene, camera);
        }

        animate();
    </script>
</body>

</html>